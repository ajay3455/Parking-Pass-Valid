<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Exterior Parking Pass Generator</title>
    <!-- Include JsBarcode Library -->
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <style>
        /* Import Google Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');

        /* General Styles */
        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #e0f7e9, #b2f2bb);
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            box-sizing: border-box;
        }

        .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
            max-width: 1200px;
            gap: 20px;
            box-sizing: border-box;
        }

        /* Form Section */
        .form-container {
            background-color: #ffffff;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 500px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .gloucester-logo img {
            display: block;
            margin: 0 auto 15px auto;
            width: 50px; /* Further reduced size */
            height: auto;
        }

        h1 {
            text-align: center;
            color: #2d6a4f;
            margin-bottom: 20px;
        }

        /* Help Button */
        .help-button {
            background-color: #d00000;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            align-self: center;
        }

        .help-button:hover {
            background-color: #9b2226;
        }

        .help-button:active {
            background-color: #6a1b21;
        }

        /* Form Fields */
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 700;
            color: #555;
        }

        input, select {
            width: 100%;
            padding: 10px;
            margin-bottom: 12px;
            border: 2px solid #2d6a4f; /* Dark Green Border */
            border-radius: 6px;
            font-size: 16px;
            box-sizing: border-box;
            transition: border-color 0.3s;
        }

        /* Error State */
        input.error, select.error {
            border-color: #d00000; /* Red Border */
        }

        button.generate-button {
            background-color: #52b788;
            color: white;
            padding: 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 18px;
            width: 100%;
            margin-top: 10px;
        }

        button.generate-button:hover {
            background-color: #40916c;
        }

        button.generate-button:active {
            background-color: #2d6a4f;
        }

        /* Ticket Preview Section */
        .ticket-container {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 600px;
            box-sizing: border-box;
        }

        .ticket-content {
            border: 2px solid #000;
            padding: 20px;
            width: 100%;
            box-sizing: border-box;
            text-align: center;
        }

        .expiry {
            font-size: 32px;
            font-weight: bold;
            color: #d00000;
            margin-bottom: 20px;
        }

        .expiry span {
            display: block;
            margin-top: 5px;
        }

        .info-box {
            border: 2px solid #95d5b2;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: left;
            box-sizing: border-box;
        }

        .info-box p {
            margin: 10px 0;
            font-size: 20px;
        }

        .info-box p strong {
            display: inline-block;
            width: 220px;
        }

        .barcode-container {
            margin-top: 20px;
        }

        .barcode-container img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto;
        }

        .warning {
            color: #d00000;
            font-weight: bold;
            margin-top: 15px;
            font-size: 18px;
        }

        /* Print Styles */
        @media print {
            body {
                margin: 0;
                padding: 0;
            }

            .container {
                padding: 0;
            }

            body * {
                visibility: hidden;
            }

            #ticketPreview, #ticketPreview * {
                visibility: visible;
            }

            #ticketPreview {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                margin: 0 auto;
                padding: 0;
                width: 100%;
                height: auto;
                display: flex;
                justify-content: center;
                align-items: flex-start;
            }

            .ticket-content {
                width: 100%;
                max-width: 100%;
                margin: 0 auto;
            }

            .action-buttons {
                display: none;
            }

            /* Set minimal page margins */
            @page {
                size: auto;
                margin: 0.25in;
            }
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            padding-top: 60px;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }

        .modal-content {
            background-color: #fff;
            margin: 5% auto;
            padding: 20px;
            border: 2px solid #2d6a4f;
            width: 80%;
            max-width: 500px;
            border-radius: 12px;
            position: relative;
        }

        .close {
            color: #aaa;
            position: absolute;
            right: 15px;
            top: 10px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover,
        .close:focus {
            color: #000;
        }
    </style>
</head>
<body>

    <div class="container">
        <!-- Form Section -->
        <div class="form-container">
            <div class="gloucester-logo">
                <img src="https://i.imgur.com/LmweghF.png" alt="The Gloucester Logo">
            </div>
            <h1>Exterior Parking Pass Generator</h1>
            <form id="passForm">
                <!-- Visitor Information Section -->
                <fieldset>
                    <legend>Visitor Information</legend>

                    <label for="visitorName">Visitor's Name:</label>
                    <input type="text" id="visitorName" placeholder="e.g., John Doe" required>

                    <label for="licensePlate">Visitor's License Plate:</label>
                    <input type="text" id="licensePlate" placeholder="e.g., ABC-1234" required>

                    <label for="visitorType">Visitor Type:</label>
                    <select id="visitorType" required>
                        <option value="">Select Visitor Type</option>
                        <option value="Resident Visitor">Resident Visitor</option>
                        <option value="Contractor">Contractor</option>
                    </select>

                    <!-- Unit Number (for Resident Visitor) -->
                    <div id="unitNumberContainer" style="display: none;">
                        <label for="unitNumber">Unit Number Visiting:</label>
                        <input type="text" id="unitNumber" placeholder="e.g., 101">
                    </div>

                    <!-- Purpose of Visit (for Contractor) -->
                    <div id="purposeContainer" style="display: none;">
                        <label for="purpose">Purpose of Visit:</label>
                        <input type="text" id="purpose" placeholder="e.g., HVAC Maintenance">
                    </div>
                </fieldset>

                <!-- Parking Details Section -->
                <fieldset>
                    <legend>Parking Details</legend>

                    <label for="duration">Duration of Pass:</label>
                    <select id="duration" required>
                        <option value="">Select Duration</option>
                        <option value="15 minutes">15 minutes</option>
                        <option value="30 minutes">30 minutes</option>
                        <option value="1 hour">1 hour</option>
                        <option value="2 hours">2 hours</option>
                        <option value="4 hours">4 hours</option>
                        <option value="8 hours">8 hours</option>
                        <option value="12 hours">12 hours</option>
                        <option value="24 hours">24 hours</option>
                    </select>

                    <div class="note">
                        Adding a phone number is mandatory if the parking permit is more than 30 minutes.
                    </div>

                    <label for="contactNumber">Visitor's Contact Number (Optional):</label>
                    <input type="text" id="contactNumber" placeholder="e.g., 123-456-7890">
                </fieldset>

                <!-- Issuing Details Section -->
                <fieldset>
                    <legend>Issuing Details</legend>

                    <label for="issuingGuard">Issuing Guard:</label>
                    <select id="issuingGuard" required>
                        <option value="">Select a guard</option>
                        <option value="Ajaypreet">Ajaypreet</option>
                        <option value="Amritpal">Amritpal</option>
                        <option value="Meet">Meet</option>
                        <option value="Jatin">Jatin</option>
                        <option value="Praveen">Praveen</option>
                        <option value="Jashanpreet">Jashanpreet</option>
                        <option value="Arnav">Arnav</option>
                        <option value="Gurwinder">Gurwinder</option>
                    </select>
                </fieldset>

                <!-- Help Button -->
                <button type="button" class="help-button" id="helpButton">Help ❓</button>
            </form>
        </div>

        <!-- Ticket Preview Section -->
        <div class="ticket-container">
            <div id="ticketPreview" class="ticket">
                <!-- Initial Sample Pass -->
                <div class="ticket-content">
                    <div class="expiry">
                        Valid Until:<br>
                        <span style="font-size: 30px;">N/A</span>
                        <span style="font-size: 28px;">N/A</span>
                        <span style="font-size: 26px;">N/A</span>
                    </div>
                    <!-- Barcode Placeholder -->
                    <div class="barcode-container">
                        <img id="barcode" alt="Barcode">
                    </div>
                    <img src="https://i.imgur.com/LmweghF.png" alt="The Gloucester Logo" class="logo-img">
                    <h2 style="font-size: 28px;">VISITOR PARKING PASS</h2>
                    <div class="info-box">
                        <p><strong>Date/Time Issued:</strong> N/A (N/A)</p>
                        <p><strong>Visitor's Name:</strong> N/A</p>
                        <p><strong>Visitor's License Plate:</strong> N/A</p>
                        <p><strong>Unit Number Visiting/Purpose:</strong> N/A</p>
                        <p><strong>Issuing Guard:</strong> N/A</p>
                    </div>
                    <p class="warning">Please display this pass on your dashboard at all times.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Instruction Modal -->
    <div id="instructionModal" class="modal">
        <div class="modal-content">
            <span class="close" id="closeModal">&times;</span>
            <h2>Instructions</h2>
            <p>Follow these steps to generate a parking pass:</p>
            <ol>
                <li>Enter the visitor's name and license plate number.</li>
                <li>Select the visitor type:
                    <ul>
                        <li>If 'Resident Visitor', enter the unit number being visited.</li>
                        <li>If 'Contractor', enter the purpose of the visit.</li>
                    </ul>
                </li>
                <li>Select the duration of the pass.</li>
                <li>If the duration is more than 30 minutes, entering the contact number is mandatory.</li>
                <li>Select your name from the 'Issuing Guard' list.</li>
                <li>The pass preview will update automatically as you fill out the form.</li>
                <li>Click 'Print Pass' to print the parking pass for the visitor.</li>
            </ol>
        </div>
    </div>

    <script>
        // Function to format the date as "28th NOV"
        function formatDate(date) {
            const day = date.getDate();
            const monthNames = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN",
                                "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"];
            const month = monthNames[date.getMonth()];

            // Get the day suffix
            function getDaySuffix(d) {
                if (d > 3 && d < 21) return 'th';
                switch (d % 10) {
                    case 1:  return "st";
                    case 2:  return "nd";
                    case 3:  return "rd";
                    default: return "th";
                }
            }

            return `${day}${getDaySuffix(day)} ${month}`;
        }

        // Handle Visitor Type Selection
        const visitorTypeSelect = document.getElementById('visitorType');
        const unitNumberContainer = document.getElementById('unitNumberContainer');
        const purposeContainer = document.getElementById('purposeContainer');
        const unitNumberInput = document.getElementById('unitNumber');
        const purposeInput = document.getElementById('purpose');

        function updateVisitorTypeFields() {
            if (visitorTypeSelect.value === 'Resident Visitor') {
                unitNumberContainer.style.display = 'block';
                purposeContainer.style.display = 'none';
                unitNumberInput.required = true;
                purposeInput.required = false;
                unitNumberInput.classList.remove('error');
                purposeInput.classList.remove('error');
            } else if (visitorTypeSelect.value === 'Contractor') {
                unitNumberContainer.style.display = 'none';
                purposeContainer.style.display = 'block';
                unitNumberInput.required = false;
                purposeInput.required = true;
                unitNumberInput.classList.remove('error');
                purposeInput.classList.remove('error');
            } else {
                unitNumberContainer.style.display = 'none';
                purposeContainer.style.display = 'none';
                unitNumberInput.required = false;
                purposeInput.required = false;
                unitNumberInput.classList.remove('error');
                purposeInput.classList.remove('error');
            }
            updatePassPreview(); // Update preview when visitor type changes
        }

        visitorTypeSelect.addEventListener('change', updateVisitorTypeFields);
        // Initial call to set up the form correctly
        updateVisitorTypeFields();

        // Handle Duration Selection for Contact Number Requirement
        const durationSelect = document.getElementById('duration');
        const contactNumberInput = document.getElementById('contactNumber');
        const contactNumberLabel = document.querySelector('label[for="contactNumber"]');

        function updateContactNumberRequirement() {
            const selectedDuration = durationSelect.value;
            const durationsRequiringContact = ['1 hour', '2 hours', '4 hours', '8 hours', '12 hours', '24 hours'];
            if (durationsRequiringContact.includes(selectedDuration)) {
                contactNumberInput.required = true;
                contactNumberLabel.innerHTML = "Visitor's Contact Number (Required):";
            } else {
                contactNumberInput.required = false;
                contactNumberLabel.innerHTML = "Visitor's Contact Number (Optional):";
            }
            validateField(contactNumberInput);
            updatePassPreview(); // Update preview when duration changes
        }

        // Validate individual field and set error class
        function validateField(field) {
            if (field.required && field.value.trim() === '') {
                field.classList.add('error');
            } else {
                field.classList.remove('error');
            }
        }

        // Event listeners for validation
        contactNumberInput.addEventListener('input', function() {
            validateField(contactNumberInput);
            updatePassPreview();
        });

        durationSelect.addEventListener('change', function() {
            updateContactNumberRequirement();
        });

        // Validation on other inputs
        const formFields = document.querySelectorAll('#passForm input, #passForm select');
        formFields.forEach(field => {
            field.addEventListener('input', function() {
                validateField(field);
                updatePassPreview();
            });
            field.addEventListener('change', function() {
                validateField(field);
                updatePassPreview();
            });
        });

        // Instruction Modal Logic
        const helpButton = document.getElementById('helpButton');
        const instructionModal = document.getElementById('instructionModal');
        const closeModal = document.getElementById('closeModal');

        helpButton.addEventListener('click', function() {
            instructionModal.style.display = 'block';
        });

        closeModal.addEventListener('click', function() {
            instructionModal.style.display = 'none';
        });

        window.addEventListener('click', function(event) {
            if (event.target == instructionModal) {
                instructionModal.style.display = 'none';
            }
        });

        // Function to generate pass HTML
        function generatePassHtml(data) {
            return `
                <div class="ticket-content">
                    <div class="expiry">
                        Valid Until:<br>
                        <span style="font-size: 30px;">${data.expirationDate}</span>
                        <span style="font-size: 28px;">${data.expirationYear}</span>
                        <span style="font-size: 26px;">${data.expirationTime}</span>
                    </div>
                    <!-- Barcode Placeholder -->
                    <div class="barcode-container">
                        <img id="barcodeImage" alt="Barcode">
                    </div>
                    <img src="https://i.imgur.com/LmweghF.png" alt="The Gloucester Logo" class="logo-img">
                    <h2 style="font-size: 28px;">VISITOR PARKING PASS</h2>
                    <div class="info-box">
                        <p><strong>Date/Time Issued:</strong> ${data.issuedDate} (${data.duration})</p>
                        <p><strong>Visitor's Name:</strong> ${data.visitorName}</p>
                        <p><strong>Visitor's License Plate:</strong> ${data.licensePlate}</p>
                        <p><strong>${data.unitOrPurposeLabel}:</strong> ${data.unitOrPurposeValue}</p>
                        <p><strong>Issuing Guard:</strong> ${data.issuingGuard}</p>
                        <!-- Contact number is not displayed -->
                    </div>
                    <p class="warning">Please display this pass on your dashboard at all times.</p>
                </div>
            `;
        }

        // Function to update the pass preview
        function updatePassPreview() {
            const visitorName = document.getElementById('visitorName').value.trim() || 'N/A';
            const licensePlate = document.getElementById('licensePlate').value.trim().toUpperCase() || 'N/A';
            const visitorType = document.getElementById('visitorType').value || 'N/A';
            const unitNumber = unitNumberInput.value.trim() || 'N/A';
            const purpose = purposeInput.value.trim() || 'N/A';
            const contactNumber = contactNumberInput.value.trim();
            const duration = durationSelect.value.trim() || 'N/A';
            const issuingGuard = document.getElementById('issuingGuard').value.trim() || 'N/A';

            // Prepare data for expiration
            const now = new Date();
            let expirationDate = new Date(now);
            switch(duration) {
                case '15 minutes':
                    expirationDate.setMinutes(expirationDate.getMinutes() + 15);
                    break;
                case '30 minutes':
                    expirationDate.setMinutes(expirationDate.getMinutes() + 30);
                    break;
                case '1 hour':
                    expirationDate.setHours(expirationDate.getHours() + 1);
                    break;
                case '2 hours':
                    expirationDate.setHours(expirationDate.getHours() + 2);
                    break;
                case '4 hours':
                    expirationDate.setHours(expirationDate.getHours() + 4);
                    break;
                case '8 hours':
                    expirationDate.setHours(expirationDate.getHours() + 8);
                    break;
                case '12 hours':
                    expirationDate.setHours(expirationDate.getHours() + 12);
                    break;
                case '24 hours':
                    expirationDate.setHours(expirationDate.getHours() + 24);
                    break;
                default:
                    expirationDate = null;
                    break;
            }

            let formattedExpirationDateForDisplay = 'N/A';
            let expirationYear = 'N/A';
            let expirationTime = 'N/A';

            if (expirationDate && duration !== 'N/A') {
                formattedExpirationDateForDisplay = formatDate(expirationDate);
                expirationYear = expirationDate.getFullYear();
                expirationTime = expirationDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            }

            // Prepare Unit Number or Purpose based on Visitor Type
            let unitOrPurposeLabel = 'Unit Number Visiting/Purpose';
            let unitOrPurposeValue = 'N/A';
            if (visitorType === 'Resident Visitor') {
                unitOrPurposeLabel = "Unit Number Visiting";
                unitOrPurposeValue = unitNumber;
            } else if (visitorType === 'Contractor') {
                unitOrPurposeLabel = "Purpose of Visit";
                unitOrPurposeValue = purpose;
            }

            // Prepare data for barcode
            let barcodeData = '';
            if (duration !== 'N/A') {
                if (['1 hour', '2 hours', '4 hours', '8 hours', '12 hours', '24 hours'].includes(duration)) {
                    barcodeData = contactNumber !== '' ? contactNumber : '000000';
                } else {
                    barcodeData = contactNumber !== '' ? contactNumber : 'N/A';
                }
            } else {
                barcodeData = 'N/A';
            }

            // Prepare data for issued date
            const formattedIssuedDate = now.toLocaleString([], { 
                year: 'numeric', month: '2-digit', day: '2-digit', 
                hour: '2-digit', minute: '2-digit', hour12: true 
            });

            // Create pass data object
            const passData = {
                expirationDate: formattedExpirationDateForDisplay,
                expirationYear: expirationYear,
                expirationTime: expirationTime,
                issuedDate: formattedIssuedDate,
                duration: duration,
                visitorName: visitorName,
                licensePlate: licensePlate,
                unitOrPurposeLabel: unitOrPurposeLabel,
                unitOrPurposeValue: unitOrPurposeValue,
                issuingGuard: issuingGuard
            };

            // Generate pass HTML
            const passHtml = generatePassHtml(passData);
            document.getElementById('ticketPreview').innerHTML = passHtml;

            // Generate Barcode
            if (barcodeData !== 'N/A') { // Only generate barcode if data is available
                JsBarcode("#barcodeImage", barcodeData, {
                    format: "CODE39",
                    displayValue: false,
                    lineColor: "#000000",
                    background: "#ffffff",
                    width: 4,    // Increased width for darker, wider bars
                    height: 100, // Increased height
                    margin: 0
                });
            } else {
                // If no valid data, clear the barcode
                document.getElementById('barcodeImage').src = "";
            }
        }

        // Initialize pass preview
        updatePassPreview();

        // Event listeners for live updating
        const form = document.getElementById('passForm');
        form.addEventListener('input', function(event) {
            const target = event.target;
            validateField(target);
            updatePassPreview();
        });

        form.addEventListener('change', function(event) {
            const target = event.target;
            validateField(target);
            updatePassPreview();
        });

        // Validation function
        function validateField(field) {
            if (field.required) {
                if (field.value.trim() === '') {
                    field.classList.add('error');
                } else {
                    field.classList.remove('error');
                }
            }
        }

        // Print Pass Button Logic
        const printButton = document.getElementById('printPass');
        printButton.addEventListener('click', function () {
            window.print();
        });
    </script>
</body>
</html>
